if(selectDeliv){var methodDeliv="#method_deliv"}else{var methodDeliv='[name = "deliveryMethodId"]'}var Order={renderOrderDetails:function(b){$(genObj.orderDetails).html(_.template($(genObj.orderDetailsTemplate).html(),{cart:Shop.Cart}));$(document).trigger({type:"renderorder.after",el:$(genObj.orderDetails)});ShopFront.Cart.initShopPage(false);Order.recountCartPage("renderOrderDetails");if(b==="start"&&Discount){Discount.renderGift(Shop.Cart.gift)}if(b!=="start"){DiscountFront.getDiscount("renderOrderDetails")}},changeDeliveryMethod:function(a){$(genObj.pM).next().show();$.get("/shop/cart_api/getPaymentsMethods/"+a,function(b){var d=JSON.parse(b),c="";if(selectPayment){c=_.template($("#orderPaymentSelect").html(),{data:d})}else{c=_.template($("#orderPaymentRadio").html(),{data:d})}$(genObj.pM).html(c);$(genObj.pM).next().hide();if(selectPayment){cuselInit($(genObj.pM),"#paymentMethod")}else{$(genObj.pM).nStRadio({wrapper:$(".frame-radio > .frame-label"),elCheckWrap:".niceRadio"})}})},displayOrderSum:function(d){var a="";if(selectDeliv){a=$(genObj.frameDelivery).find("span.cuselActive")}else{a=$(methodDeliv).filter(":checked")}Shop.Cart.shipping=parseFloat(a.data("price"));Shop.Cart.shipFreeFrom=parseFloat(a.data("freefrom"));$(genObj.shipping).html(parseFloat(Shop.Cart.shipping).toFixed(pricePrecision));var g=Shop.Cart.discount,f=parseFloat(Shop.Cart.kitDiscount),b=Shop.Cart.getFinalAmount();if(Shop.Cart.koefCurr==undefined){var c=parseFloat(Shop.Cart.totalPrice).toFixed(pricePrecision),e=parseFloat(Shop.Cart.totalAddPrice).toFixed(pricePrecision);Shop.Cart.koefCurr=e/c}if(g!=null&&g!=0){b=b-d.result_sum_discount_convert}if(f!=0){b=b-f}b=b>Shop.Cart.shipping?b:Shop.Cart.shipping;$(genObj.totalPrice).html(parseFloat(Shop.Cart.getTotalPriceOrigin()).toFixed(pricePrecision));$(genObj.finalAmount).html(parseFloat(b).toFixed(pricePrecision));$(genObj.finalAmountAdd).html((Shop.Cart.koefCurr*b).toFixed(pricePrecision));$(genObj.frameGenSumDiscount).hide();$(genObj.genSumDiscount).hide();$(genObj.totalPrice).hide();if((d!=null&&parseFloat(d.result_sum_discount_convert)>0)||f!=0){$(genObj.genSumDiscount).show();$(genObj.frameGenSumDiscount).show();$(genObj.totalPrice).show()}},recountCartPage:function(b){Shop.Cart.totalRecount();Order.hideInfoDiscount();if(b!=="renderOrderDetails"){DiscountFront.getDiscount("recountCartPage")}},hideInfoDiscount:function(){$(genObj.discount).empty().next(preloader).show()},displayInfoDiscount:function(a){$(genObj.pageCart).find(genObj.frameDiscount).hide();$(genObj.frameGenDiscount).hide();if($.trim(a)==""){$(genObj.pageCart).find(genObj.frameDiscount).show()}if(!($.trim(a)==""&&Shop.Cart.discountProduct==0)){$(genObj.frameGenDiscount).show()}$(genObj.discount).html(a).next(preloader).hide()},renderGiftInput:function(a){if(a==""){$(genObj.gift).empty();$(genObj.frameGift).hide()}else{$(genObj.gift).html(a);$(genObj.frameGift).show()}$("#giftButton").click(function(c){$(genObj.gift).find(preloader).show();var b=0;$.ajax({url:"/mod_discount/discount_api/get_gift_certificate",data:"key="+$("[name=giftcert]").val(),type:"GET",success:function(d){if(d!=""){b=JSON.parse(d)}$(genObj.gift).find(preloader).hide();Shop.Cart.gift=b;if(b.error){$(document).trigger({type:"discount.giftError",datas:b.mes})}if(!b.error&&Discount){Discount.loadCertificat(Shop.Cart.gift)}}});c.preventDefault()});$("#giftInput").keydown(function(b){if(b.keyCode==13){$("#giftButton").trigger("click");b.preventDefault()}})},giftError:function(a){$(genObj.gift).children(genObj.msgF).remove();if(a){$(genObj.gift).append(message.error(a));drawIcons($(genObj.gift).find(selIcons))}},renderGiftSucces:function(a,b){$(genObj.certPrice).html(b.value);$(genObj.certFrame).show();$(genObj.gift).children(genObj.msgF).remove();$(genObj.gift).html(a);Order.recountCartPage("renderGiftSucces")}};$(document).on("scriptDefer",function(){if(selectDeliv){cuselInit($(genObj.frameDelivery),methodDeliv);$(methodDeliv).on("change.methoddeliv",function(){var a=$(genObj.frameDelivery).find("span.cuselActive").attr("val");Order.changeDeliveryMethod(a);Order.recountCartPage("change.methoddeliv")})}else{$(".check-variant-delivery").nStRadio({wrapper:$(".frame-radio > .frame-label"),elCheckWrap:".niceRadio",before:function(a){$(document).trigger("showActivity");$('[name="'+$(a).find("input").attr("name")+'"]').attr("disabled","disabled")},after:function(b,c){if(!c){var a=b.find("input").val();Order.changeDeliveryMethod(a);Order.recountCartPage("change_delivery");$('[name="'+$(b).find("input").attr("name")+'"]').removeAttr("disabled")}}})}if(selectPayment){cuselInit($(genObj.pM),"#paymentMethod")}else{$(genObj.pM).nStRadio({wrapper:$(".frame-radio > .frame-label"),elCheckWrap:".niceRadio"})}$(document).on("sync_cart",function(){Order.renderOrderDetails()});$(document).on("count_changed",function(){Order.recountCartPage("count_changed")});$(document).on("cart_rm",function(a){Order.recountCartPage("cart_rm")});$(document).on("discount.display",function(a){Order.displayInfoDiscount(a.tpl)});Order.renderOrderDetails("start")});function initOrderTrEv(){$(document).on("discount.renderGiftInput",function(a){Order.renderGiftInput(a.tpl)});$(document).on("discount.giftError",function(a){Order.giftError(a.datas)});$(document).on("discount.renderGiftSucces",function(a){Order.renderGiftSucces(a.tpl,a.datas)});$(document).on("displayDiscount",function(a){Order.displayOrderSum(a.obj)});$(".maskPhoneFrame input").mask("+9 (9999) 999-99-99")};